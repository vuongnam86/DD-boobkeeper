{"version":3,"file":"index.mjs","sources":["../../../../src/composables/useRegistry/index.ts"],"sourcesContent":["import {\n  type ComponentInternalInstance,\n  computed,\n  inject,\n  provide,\n  readonly,\n  type Ref,\n  ref,\n} from 'vue'\nimport {\n  breadcrumbGlobalIndexKey,\n  breadcrumbRegistryKey,\n  modalManagerKey,\n  type RegisterShowHideFnInput,\n  type RegisterShowHideInstances,\n  type RegisterShowHideMapValue,\n  rtlRegistryKey,\n  showHideRegistryKey,\n} from '../../utils/keys'\nimport type {BAppProps} from '../../types/ComponentProps'\nimport type {BreadcrumbItemRaw} from '../../types/BreadcrumbTypes'\n\nexport const useRegistry = (rtl: BAppProps['rtl'] = false) => {\n  const showHideStorage = inject(showHideRegistryKey, undefined)\n  if (!showHideStorage) {\n    const {register, values} = _newShowHideRegistry()\n    provide(showHideRegistryKey, {register, values})\n  }\n\n  const modalManager = inject(modalManagerKey, undefined)\n  if (!modalManager) {\n    const stack: Ref<Map<number, ComponentInternalInstance>> = ref(new Map())\n\n    const countStack = computed(() => stack.value.size)\n    const valuesStack = computed(() => [...stack.value.values()])\n    const lastStack = computed(() => valuesStack.value[valuesStack.value.length - 1])\n\n    const pushStack = (modal: Readonly<ComponentInternalInstance>) => {\n      stack.value.set(modal.uid, modal)\n    }\n    const removeStack = (modal: Readonly<ComponentInternalInstance>) => {\n      stack.value.delete(modal.uid)\n    }\n\n    /**\n     * A collection of all registered modals\n     */\n    const registry: Ref<Map<number, ComponentInternalInstance>> = ref(new Map())\n\n    // Utility getters not made, would not be used (count, last)\n\n    const pushRegistry = (modal: Readonly<ComponentInternalInstance>) => {\n      registry.value.set(modal.uid, modal)\n    }\n    const removeRegistry = (modal: Readonly<ComponentInternalInstance>) => {\n      registry.value.delete(modal.uid)\n    }\n\n    provide(modalManagerKey, {\n      countStack,\n      lastStack,\n      registry: computed(() => registry.value),\n      stack: valuesStack,\n      pushStack,\n      removeStack,\n      pushRegistry,\n      removeRegistry,\n    })\n  }\n\n  const breadcrumb = inject(breadcrumbRegistryKey, undefined)\n  if (!breadcrumb) {\n    const items = ref<Record<string, BreadcrumbItemRaw[]>>({\n      [breadcrumbGlobalIndexKey]: [],\n    })\n    const reset = (key: string = breadcrumbGlobalIndexKey) => {\n      items.value[key] = []\n    }\n\n    provide(breadcrumbRegistryKey, {items, reset})\n  }\n\n  const rtlRegistry = inject(rtlRegistryKey, undefined)\n  if (!rtlRegistry) {\n    const rtlDefault = false\n    const localeDefault = undefined\n\n    const rtlInitial = typeof rtl === 'boolean' ? rtlDefault : (rtl?.rtlInitial ?? rtlDefault)\n\n    const localeInitial =\n      typeof rtl === 'boolean' ? localeDefault : (rtl?.localeInitial ?? localeDefault)\n\n    const isRtl = ref(rtlInitial)\n    const locale = ref(localeInitial)\n\n    provide(rtlRegistryKey, {isRtl, locale})\n  }\n}\n\n// Helper function to create getActive method for instance holders\nconst createGetActive = (instances: RegisterShowHideMapValue[]) => () =>\n  instances.length > 0 ? instances[instances.length - 1] : undefined\n\nexport const _newShowHideRegistry = () => {\n  const values: Ref<Map<string, RegisterShowHideInstances>> = ref(new Map())\n\n  const register = ({\n    id,\n    component,\n    value,\n    toggle,\n    show,\n    hide,\n    registerTrigger,\n    unregisterTrigger,\n  }: RegisterShowHideFnInput) => {\n    let currentId = id\n    const instanceValue: RegisterShowHideMapValue = {\n      id,\n      component,\n      value: readonly(value),\n      toggle,\n      show,\n      hide,\n      registerTrigger,\n      unregisterTrigger,\n    }\n\n    // Get or create the instances array for this ID\n    let instancesHolder = values.value.get(currentId)\n    if (!instancesHolder) {\n      const instances: RegisterShowHideMapValue[] = []\n      instancesHolder = {\n        instances,\n        // Returns the last mounted instance (most recent)\n        getActive: createGetActive(instances),\n      }\n      values.value.set(currentId, instancesHolder)\n    }\n\n    // Append this instance to the array\n    instancesHolder.instances.push(instanceValue)\n\n    const componentUid = component.uid\n\n    return {\n      unregister() {\n        const holder = values.value.get(currentId)\n        if (!holder) return\n\n        // Remove only this component's instance by UID\n        const index = holder.instances.findIndex(\n          (inst: RegisterShowHideMapValue) => inst.component.uid === componentUid\n        )\n        if (index !== -1) {\n          holder.instances.splice(index, 1)\n        }\n\n        // Clean up the map entry if no instances remain\n        if (holder.instances.length === 0) {\n          values.value.delete(currentId)\n        }\n      },\n      updateId(newId: string, oldId: string) {\n        const holder = values.value.get(oldId)\n        if (!holder) return\n\n        // Find this component's instance in the array\n        const instance = holder.instances.find(\n          (inst: RegisterShowHideMapValue) => inst.component.uid === componentUid\n        )\n        if (!instance) return\n\n        // Update the ID in the instance\n        instance.id = newId\n\n        // Get or create holder for new ID\n        let newHolder = values.value.get(newId)\n        if (!newHolder) {\n          const instances: RegisterShowHideMapValue[] = []\n          newHolder = {\n            instances,\n            getActive: createGetActive(instances),\n          }\n          values.value.set(newId, newHolder)\n        }\n\n        // Move this instance to the new ID's array\n        const index = holder.instances.findIndex(\n          (inst: RegisterShowHideMapValue) => inst.component.uid === componentUid\n        )\n        if (index !== -1) {\n          holder.instances.splice(index, 1)\n          newHolder.instances.push(instance)\n        }\n\n        // Clean up old ID if no instances remain\n        if (holder.instances.length === 0) {\n          values.value.delete(oldId)\n        }\n        // Keep local id in sync so unregister() uses the latest key\n        currentId = newId\n      },\n    }\n  }\n  return {\n    register,\n    values,\n  }\n}\n"],"names":[],"mappings":"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"}