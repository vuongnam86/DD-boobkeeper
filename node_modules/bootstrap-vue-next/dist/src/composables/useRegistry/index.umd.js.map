{"version":3,"file":"index.umd.js","sources":["../../../../src/composables/useRegistry/index.ts"],"sourcesContent":["import {\n  type ComponentInternalInstance,\n  computed,\n  inject,\n  provide,\n  readonly,\n  type Ref,\n  ref,\n} from 'vue'\nimport {\n  breadcrumbGlobalIndexKey,\n  breadcrumbRegistryKey,\n  modalManagerKey,\n  type RegisterShowHideFnInput,\n  type RegisterShowHideInstances,\n  type RegisterShowHideMapValue,\n  rtlRegistryKey,\n  showHideRegistryKey,\n} from '../../utils/keys'\nimport type {BAppProps} from '../../types/ComponentProps'\nimport type {BreadcrumbItemRaw} from '../../types/BreadcrumbTypes'\n\nexport const useRegistry = (rtl: BAppProps['rtl'] = false) => {\n  const showHideStorage = inject(showHideRegistryKey, undefined)\n  if (!showHideStorage) {\n    const {register, values} = _newShowHideRegistry()\n    provide(showHideRegistryKey, {register, values})\n  }\n\n  const modalManager = inject(modalManagerKey, undefined)\n  if (!modalManager) {\n    const stack: Ref<Map<number, ComponentInternalInstance>> = ref(new Map())\n\n    const countStack = computed(() => stack.value.size)\n    const valuesStack = computed(() => [...stack.value.values()])\n    const lastStack = computed(() => valuesStack.value[valuesStack.value.length - 1])\n\n    const pushStack = (modal: Readonly<ComponentInternalInstance>) => {\n      stack.value.set(modal.uid, modal)\n    }\n    const removeStack = (modal: Readonly<ComponentInternalInstance>) => {\n      stack.value.delete(modal.uid)\n    }\n\n    /**\n     * A collection of all registered modals\n     */\n    const registry: Ref<Map<number, ComponentInternalInstance>> = ref(new Map())\n\n    // Utility getters not made, would not be used (count, last)\n\n    const pushRegistry = (modal: Readonly<ComponentInternalInstance>) => {\n      registry.value.set(modal.uid, modal)\n    }\n    const removeRegistry = (modal: Readonly<ComponentInternalInstance>) => {\n      registry.value.delete(modal.uid)\n    }\n\n    provide(modalManagerKey, {\n      countStack,\n      lastStack,\n      registry: computed(() => registry.value),\n      stack: valuesStack,\n      pushStack,\n      removeStack,\n      pushRegistry,\n      removeRegistry,\n    })\n  }\n\n  const breadcrumb = inject(breadcrumbRegistryKey, undefined)\n  if (!breadcrumb) {\n    const items = ref<Record<string, BreadcrumbItemRaw[]>>({\n      [breadcrumbGlobalIndexKey]: [],\n    })\n    const reset = (key: string = breadcrumbGlobalIndexKey) => {\n      items.value[key] = []\n    }\n\n    provide(breadcrumbRegistryKey, {items, reset})\n  }\n\n  const rtlRegistry = inject(rtlRegistryKey, undefined)\n  if (!rtlRegistry) {\n    const rtlDefault = false\n    const localeDefault = undefined\n\n    const rtlInitial = typeof rtl === 'boolean' ? rtlDefault : (rtl?.rtlInitial ?? rtlDefault)\n\n    const localeInitial =\n      typeof rtl === 'boolean' ? localeDefault : (rtl?.localeInitial ?? localeDefault)\n\n    const isRtl = ref(rtlInitial)\n    const locale = ref(localeInitial)\n\n    provide(rtlRegistryKey, {isRtl, locale})\n  }\n}\n\n// Helper function to create getActive method for instance holders\nconst createGetActive = (instances: RegisterShowHideMapValue[]) => () =>\n  instances.length > 0 ? instances[instances.length - 1] : undefined\n\nexport const _newShowHideRegistry = () => {\n  const values: Ref<Map<string, RegisterShowHideInstances>> = ref(new Map())\n\n  const register = ({\n    id,\n    component,\n    value,\n    toggle,\n    show,\n    hide,\n    registerTrigger,\n    unregisterTrigger,\n  }: RegisterShowHideFnInput) => {\n    let currentId = id\n    const instanceValue: RegisterShowHideMapValue = {\n      id,\n      component,\n      value: readonly(value),\n      toggle,\n      show,\n      hide,\n      registerTrigger,\n      unregisterTrigger,\n    }\n\n    // Get or create the instances array for this ID\n    let instancesHolder = values.value.get(currentId)\n    if (!instancesHolder) {\n      const instances: RegisterShowHideMapValue[] = []\n      instancesHolder = {\n        instances,\n        // Returns the last mounted instance (most recent)\n        getActive: createGetActive(instances),\n      }\n      values.value.set(currentId, instancesHolder)\n    }\n\n    // Append this instance to the array\n    instancesHolder.instances.push(instanceValue)\n\n    const componentUid = component.uid\n\n    return {\n      unregister() {\n        const holder = values.value.get(currentId)\n        if (!holder) return\n\n        // Remove only this component's instance by UID\n        const index = holder.instances.findIndex(\n          (inst: RegisterShowHideMapValue) => inst.component.uid === componentUid\n        )\n        if (index !== -1) {\n          holder.instances.splice(index, 1)\n        }\n\n        // Clean up the map entry if no instances remain\n        if (holder.instances.length === 0) {\n          values.value.delete(currentId)\n        }\n      },\n      updateId(newId: string, oldId: string) {\n        const holder = values.value.get(oldId)\n        if (!holder) return\n\n        // Find this component's instance in the array\n        const instance = holder.instances.find(\n          (inst: RegisterShowHideMapValue) => inst.component.uid === componentUid\n        )\n        if (!instance) return\n\n        // Update the ID in the instance\n        instance.id = newId\n\n        // Get or create holder for new ID\n        let newHolder = values.value.get(newId)\n        if (!newHolder) {\n          const instances: RegisterShowHideMapValue[] = []\n          newHolder = {\n            instances,\n            getActive: createGetActive(instances),\n          }\n          values.value.set(newId, newHolder)\n        }\n\n        // Move this instance to the new ID's array\n        const index = holder.instances.findIndex(\n          (inst: RegisterShowHideMapValue) => inst.component.uid === componentUid\n        )\n        if (index !== -1) {\n          holder.instances.splice(index, 1)\n          newHolder.instances.push(instance)\n        }\n\n        // Clean up old ID if no instances remain\n        if (holder.instances.length === 0) {\n          values.value.delete(oldId)\n        }\n        // Keep local id in sync so unregister() uses the latest key\n        currentId = newId\n      },\n    }\n  }\n  return {\n    register,\n    values,\n  }\n}\n"],"names":["createGetActive","instances","length","_newShowHideRegistry","values","ref","Map","register","id","component","value","toggle","show","hide","registerTrigger","unregisterTrigger","currentId","instanceValue","readonly","instancesHolder","get","getActive","set","push","componentUid","uid","unregister","holder","index","findIndex","inst","splice","delete","updateId","newId","oldId","instance","find","newHolder","rtl","inject","showHideRegistryKey","provide","modalManagerKey","stack","countStack","computed","size","valuesStack","lastStack","pushStack","modal","removeStack","registry","pushRegistry","removeRegistry","breadcrumbRegistryKey","items","breadcrumbGlobalIndexKey","reset","key","rtlRegistryKey","rtlDefault","localeDefault","rtlInitial","localeInitial","isRtl","locale"],"mappings":"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"}