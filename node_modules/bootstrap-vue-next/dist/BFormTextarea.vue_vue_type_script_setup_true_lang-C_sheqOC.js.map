{"version":3,"file":"BFormTextarea.vue_vue_type_script_setup_true_lang-C_sheqOC.js","sources":["../src/components/BFormTextarea/BFormTextarea.vue","../src/composables/useTextareaResize.ts"],"sourcesContent":["<template>\n  <textarea\n    :id=\"computedId\"\n    ref=\"_input\"\n    :key=\"forceUpdateKey\"\n    :class=\"computedClasses\"\n    :name=\"props.name || undefined\"\n    :form=\"props.form || undefined\"\n    :value=\"modelValue ?? undefined\"\n    :disabled=\"props.disabled\"\n    :placeholder=\"props.placeholder\"\n    :required=\"props.required || undefined\"\n    :autocomplete=\"props.autocomplete || undefined\"\n    :readonly=\"props.readonly || props.plaintext\"\n    :aria-required=\"props.required || undefined\"\n    :aria-invalid=\"computedAriaInvalid\"\n    :rows=\"computedRows || 2\"\n    :style=\"computedStyles\"\n    :wrap=\"props.wrap || undefined\"\n    @input=\"\n      (e) => {\n        onInput(e)\n        handleHeightChange()\n      }\n    \"\n    @change=\"onChange\"\n    @blur=\"onBlur\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport type {BFormTextareaProps} from '../../types/ComponentProps'\nimport {computed, type CSSProperties, useTemplateRef} from 'vue'\nimport {useDefaults} from '../../composables/useDefaults'\nimport {normalizeInput} from '../../utils/normalizeInput'\nimport {useFormInput} from '../../composables/useFormInput'\nimport {useTextareaResize} from '../../composables/useTextareaResize'\n\nconst _props = withDefaults(defineProps<Omit<BFormTextareaProps, 'modelValue'>>(), {\n  // CommonInputProps\n  ariaInvalid: undefined,\n  autocomplete: undefined,\n  autofocus: false,\n  debounce: 0,\n  debounceMaxWait: Number.NaN,\n  disabled: false,\n  form: undefined,\n  formatter: undefined,\n  id: undefined,\n  lazyFormatter: false,\n  list: undefined,\n  modelValue: '',\n  name: undefined,\n  placeholder: undefined,\n  plaintext: false,\n  readonly: false,\n  required: false,\n  size: undefined,\n  state: undefined,\n  // End CommonInputProps\n  noResize: false,\n  noAutoShrink: false,\n  maxRows: undefined,\n  rows: 2,\n  wrap: 'soft',\n})\nconst props = useDefaults(_props, 'BFormTextarea')\n\nconst [modelValue, modelModifiers] = defineModel<\n  Exclude<BFormTextareaProps['modelValue'], undefined>,\n  'trim' | 'lazy' | 'number'\n>({\n  default: '',\n  set: (v) => normalizeInput(v, modelModifiers),\n})\n\nconst input = useTemplateRef('_input')\n\nconst {\n  computedId,\n  forceUpdateKey,\n  computedAriaInvalid,\n  onInput,\n  stateClass,\n  onChange,\n  onBlur,\n  focus,\n  blur,\n} = useFormInput(props, input, modelValue, modelModifiers)\n\nconst computedClasses = computed(() => [\n  stateClass.value,\n  props.plaintext ? 'form-control-plaintext' : 'form-control',\n  {\n    [`form-control-${props.size}`]: !!props.size,\n  },\n])\n\nconst {\n  computedStyles: resizeStyles,\n  onInput: handleHeightChange,\n  computedRows,\n} = useTextareaResize(input, {\n  maxRows: () => props.maxRows,\n  rows: () => props.rows,\n  noAutoShrink: () => props.noAutoShrink,\n})\n\nconst computedStyles = computed<CSSProperties>(() => ({\n  resize: props.noResize ? 'none' : undefined,\n  ...(props.maxRows || props.noAutoShrink ? resizeStyles.value : undefined),\n}))\n\ndefineExpose({\n  blur,\n  element: input,\n  focus,\n})\n</script>\n","import {useToNumber} from '@vueuse/core'\nimport type {Numberish} from '../types/CommonTypes'\nimport {\n  computed,\n  type CSSProperties,\n  type MaybeRefOrGetter,\n  nextTick,\n  onMounted,\n  ref,\n  type ShallowRef,\n  toValue,\n} from 'vue'\nimport {isVisible} from '../utils/dom'\n\nexport const useTextareaResize = (\n  input: Readonly<ShallowRef<HTMLTextAreaElement | null>>,\n  {\n    maxRows,\n    noAutoShrink,\n    rows,\n  }: {\n    rows: MaybeRefOrGetter<Numberish>\n    maxRows: MaybeRefOrGetter<Numberish | undefined>\n    noAutoShrink: MaybeRefOrGetter<boolean>\n  }\n) => {\n  const height = ref<number | null | string>(0)\n  const maxRowsNumber = useToNumber(\n    computed(() => toValue(maxRows) || Number.NaN),\n    {\n      method: 'parseInt',\n      nanToZero: true,\n    }\n  )\n  const rowsNumber = useToNumber(rows, {\n    method: 'parseInt',\n    nanToZero: true,\n  })\n  const computedMinRows = computed(() => Math.max(rowsNumber.value || 2, 2))\n  const computedMaxRows = computed(() => Math.max(computedMinRows.value, maxRowsNumber.value || 0))\n  const computedRows = computed(() =>\n    computedMinRows.value === computedMaxRows.value ? computedMinRows.value : null\n  )\n\n  const handleHeightChange = async () => {\n    // Element must be visible (not hidden) and in document\n    // Must be checked after above checks\n    if (!input.value || !isVisible(input.value)) {\n      height.value = null\n      return\n    }\n\n    // Get current computed styles\n    const computedStyle = getComputedStyle(input.value)\n    // Height of one line of text in px\n    const lineHeight = Number.parseFloat(computedStyle.lineHeight) || 1\n    // Calculate height of border and padding\n    const border =\n      (Number.parseFloat(computedStyle.borderTopWidth) || 0) +\n      (Number.parseFloat(computedStyle.borderBottomWidth) || 0)\n    const padding =\n      (Number.parseFloat(computedStyle.paddingTop) || 0) +\n      (Number.parseFloat(computedStyle.paddingBottom) || 0)\n    // Calculate offset\n    const offset = border + padding\n    // Minimum height for min rows (which must be 2 rows or greater for cross-browser support)\n    const minHeight = lineHeight * computedMinRows.value + offset\n\n    // Get the current style height (with `px` units)\n    const oldHeight = input.value.style.height || computedStyle.height\n    // Probe scrollHeight by temporarily changing the height to `auto`\n    height.value = 'auto'\n    await nextTick() // We need to wait for the dom to update. These cannot be batched in the same tick\n    const {scrollHeight} = input.value\n    // Place the original old height back on the element, just in case `computedProp`\n    // returns the same value as before\n    height.value = oldHeight\n    await nextTick() // We need to wait for the dom to update. These cannot be batched in the same tick\n\n    // Calculate content height in 'rows' (scrollHeight includes padding but not border)\n    const contentRows = Math.max((scrollHeight - padding) / lineHeight, 2)\n    // Calculate number of rows to display (limited within min/max rows)\n    const rows = Math.min(Math.max(contentRows, computedMinRows.value), computedMaxRows.value)\n    // Calculate the required height of the textarea including border and padding (in pixels)\n    const newHeight = Math.max(Math.ceil(rows * lineHeight + offset), minHeight)\n\n    // Computed height remains the larger of `oldHeight` and new `height`,\n    // when height is in `sticky` mode (prop `no-auto-shrink` is true)\n    if (toValue(noAutoShrink) && (Number.parseFloat(oldHeight.toString()) || 0) > newHeight) {\n      height.value = oldHeight\n      return\n    }\n\n    // Return the new computed CSS height in px units\n    height.value = `${newHeight}px`\n  }\n\n  onMounted(handleHeightChange)\n\n  const computedStyles = computed<CSSProperties>(() => ({\n    resize: 'none',\n    height:\n      typeof height.value === 'string'\n        ? height.value\n        : height.value\n          ? `${height.value}px`\n          : undefined,\n  }))\n\n  return {\n    onInput: handleHeightChange,\n    computedStyles,\n    computedRows,\n  }\n}\n"],"names":["_props","__props","props","useDefaults","modelValue","modelModifiers","_useModel","set","v","normalizeInput","input","useTemplateRef","computedId","forceUpdateKey","computedAriaInvalid","onInput","stateClass","onChange","onBlur","focus","blur","useFormInput","computedClasses","computed","value","plaintext","size","computedStyles","resizeStyles","handleHeightChange","computedRows","maxRows","noAutoShrink","rows","height","ref","maxRowsNumber","useToNumber","toValue","Number","NaN","method","nanToZero","rowsNumber","computedMinRows","Math","max","computedMaxRows","async","isVisible","computedStyle","getComputedStyle","lineHeight","parseFloat","border","borderTopWidth","borderBottomWidth","padding","paddingTop","paddingBottom","offset","minHeight","oldHeight","style","nextTick","scrollHeight","contentRows","min","newHeight","ceil","toString","onMounted","resize","useTextareaResize","noResize","__expose","element","_createElementBlock","id","_unref","key","class","name","form","disabled","placeholder","required","autocomplete","readonly","wrap","_cache","e","args"],"mappings":"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"}