"use strict";const e=require("vue"),l=require("./index-C8tYBJvG.js"),t=require("./useDefaults-DspAih6L.js"),r=require("./useId-owZCNodL.js"),a=require("./useStateClass-B3zxUwpk.js"),o=require("./dom-Cbel14Rh.js"),i=["for"],u=["aria-disabled"],n=["id","disabled","aria-label","aria-labelledby"],s={class:"b-form-file-text"},d={key:0},c={key:1,class:"text-muted"},f={key:0,class:"b-form-file-drag-overlay"},p={class:"b-form-file-drag-text"},m=["name","form","multiple","disabled","required","accept","capture","directory","webkitdirectory"],v=["id","form","name","multiple","disabled","capture","accept","required","aria-label","aria-labelledby","aria-required","directory","webkitdirectory"],y={key:3,class:"b-form-file-display mt-2"},b={key:0,class:"small text-muted"},k={key:1,class:"small text-muted"},h={key:4,class:"visually-hidden","aria-live":"polite","aria-atomic":"true"},B=e.defineComponent({inheritAttrs:!1,__name:"BFormFile",props:e.mergeModels({ariaLabel:{default:void 0},ariaLabelledby:{default:void 0},accept:{default:""},autofocus:{type:Boolean,default:!1},browseText:{default:void 0},capture:{default:void 0},directory:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},dropPlaceholder:{default:void 0},fileNameFormatter:{type:Function,default:void 0},form:{default:void 0},id:{default:void 0},label:{default:""},labelClass:{default:void 0},multiple:{type:Boolean,default:!1},name:{default:void 0},noButton:{type:Boolean,default:!1},noDrop:{type:Boolean,default:!1},plain:{type:Boolean,default:!1},placeholder:{default:"No file chosen"},required:{type:Boolean,default:!1},showFileNames:{type:Boolean,default:!1},size:{default:void 0},state:{type:[Boolean,null],default:null}},{modelValue:{default:null},modelModifiers:{}}),emits:e.mergeModels(["change"],["update:modelValue"]),setup(B,{expose:g,emit:w}){const C=B,D=t.useDefaults(C,"BFormFile"),E=e.useSlots(),N=w,S=e.useModel(B,"modelValue"),x=e.useAttrs(),V=e.computed(()=>{if(D.plain)return{wrapperAttrs:{},inputAttrs:x};const{class:e,style:l,...t}=x,r={};return void 0!==e&&(r.class=e),void 0!==l&&(r.style=l),{wrapperAttrs:r,inputAttrs:t}}),q=r.useId(()=>D.id),R=a.useStateClass(()=>D.state),T=e.useTemplateRef("rootRef"),A=e.useTemplateRef("dropZoneRef"),F=e.useTemplateRef("browseButtonRef"),$=e.useTemplateRef("plainInputRef"),z=e.useTemplateRef("customInputRef"),_=e.computed(()=>"string"==typeof D.accept?D.accept:D.accept.join(",")),{open:L,reset:j,onChange:I}=l.useFileDialog({accept:_.value,multiple:D.multiple||D.directory,directory:D.directory,input:z}),{isOverDropZone:M}=l.useDropZone(A,{onDrop:e=>{e&&!D.noDrop&&le(e)},multiple:D.multiple||D.directory}),P=e.computed(()=>!o.isEmptySlot(E.label)),Z=e.computed(()=>!o.isEmptySlot(E.placeholder)),O=e.computed(()=>[R.value,{[`form-control-${D.size}`]:void 0!==D.size}]),W=e.computed(()=>["form-control",R.value,{[`form-control-${D.size}`]:void 0!==D.size}]),G=e.ref([]),H=e.computed(()=>G.value),J=e.computed(()=>H.value.length>0),K=e.computed(()=>H.value.map(e=>e.name)),Q=e.computed(()=>{if(!J.value)return"";if(D.fileNameFormatter)return D.fileNameFormatter(H.value);const e=K.value;return 1===e.length?e[0]:`${e.length} files selected`}),U=e.computed(()=>!D.plain&&D.showFileNames&&(J.value||D.placeholder)),X=e.computed(()=>{if(!J.value)return"";const e=H.value.length;return 1===e?`File selected: ${H.value[0].name}`:`${e} files selected`}),Y=e.computed(()=>D.browseText??"Browse"),ee=e.computed(()=>D.dropPlaceholder??"Drop files here..."),le=(l,t)=>{let r=[];if(t){const e=t.target;r=e.files?Array.from(e.files):[]}else if(r=Array.from(l).filter(e=>(e=>!_.value||_.value.split(",").map(e=>e.trim()).some(l=>{if(l.startsWith("."))return e.name.toLowerCase().endsWith(l.toLowerCase());if(!l.includes("*"))return e.type===l;const t=l.indexOf("/");if(-1===t)return!1;const r=l.slice(0,t);return"*"===r||e.type.startsWith(`${r}/`)}))(e)),z.value&&"undefined"!=typeof DataTransfer)try{const e=new DataTransfer;r.forEach(l=>e.items.add(l)),z.value.files=e.files}catch{}if(G.value=r,0===r.length)S.value=null;else if(D.directory||D.multiple)S.value=r;else{const[e]=r;S.value=e}e.nextTick(()=>{if(t)N("change",t);else{const e=new CustomEvent("change",{bubbles:!0,cancelable:!1,detail:{files:r,target:{files:r}}});Object.defineProperty(e,"files",{value:r,enumerable:!0}),N("change",e)}})},te=()=>{D.disabled||L({accept:_.value,multiple:D.multiple||D.directory,directory:D.directory})},re=()=>{D.disabled||te()},ae=e=>{const l=e.target;l.files&&le(l.files,e)};I(e=>{e&&le(e)});const oe=()=>{D.plain?$.value?.focus():F.value?.focus()};return e.onMounted(()=>{D.autofocus&&e.nextTick(()=>{oe()})}),e.watch(()=>D.autofocus,e=>{e&&oe()}),e.watch(S,e=>{null===e?(G.value=[],$.value&&($.value.value="")):Array.isArray(e)?G.value=e:G.value=[e]}),g({blur:()=>{D.plain?$.value?.blur():F.value?.blur()},element:e.computed(()=>D.plain?$.value:F.value),focus:oe,reset:()=>{G.value=[],S.value=null,j(),$.value&&($.value.value="")}}),(l,t)=>(e.openBlock(),e.createElementBlock("div",e.mergeProps({ref_key:"rootRef",ref:T},V.value.wrapperAttrs,{class:"b-form-file-root"}),[P.value||e.unref(D).label?(e.openBlock(),e.createElementBlock("label",{key:0,class:e.normalizeClass(["form-label",e.unref(D).labelClass]),for:e.unref(q)},[e.renderSlot(l.$slots,"label",{},()=>[e.createTextVNode(e.toDisplayString(e.unref(D).label),1)])],10,i)):e.createCommentVNode("",!0),e.unref(D).plain?(e.openBlock(),e.createElementBlock("input",e.mergeProps({key:2,id:e.unref(q),ref_key:"plainInputRef",ref:$},V.value.inputAttrs,{type:"file",class:W.value,form:e.unref(D).form,name:e.unref(D).name,multiple:e.unref(D).multiple||e.unref(D).directory,disabled:e.unref(D).disabled,capture:e.unref(D).capture,accept:_.value||void 0,required:e.unref(D).required||void 0,"aria-label":e.unref(D).ariaLabel,"aria-labelledby":e.unref(D).ariaLabelledby,"aria-required":e.unref(D).required||void 0,directory:e.unref(D).directory,webkitdirectory:e.unref(D).directory,onChange:ae}),null,16,v)):(e.openBlock(),e.createElementBlock("div",{key:1,ref_key:"dropZoneRef",ref:A,class:e.normalizeClass(["b-form-file-wrapper",{"b-form-file-dragging":e.unref(M)&&!e.unref(D).noDrop,"b-form-file-has-files":J.value}])},[e.createElementVNode("div",{class:e.normalizeClass(["b-form-file-control",O.value]),"aria-disabled":e.unref(D).disabled,onClick:re},[e.unref(D).noButton?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:0,id:e.unref(q),ref_key:"browseButtonRef",ref:F,type:"button",class:"b-form-file-button",disabled:e.unref(D).disabled,"aria-label":e.unref(D).ariaLabel,"aria-labelledby":e.unref(D).ariaLabelledby,onClick:e.withModifiers(te,["stop"])},e.toDisplayString(Y.value),9,n)),e.createElementVNode("div",s,[e.renderSlot(l.$slots,"file-name",{files:H.value,names:K.value},()=>[J.value?(e.openBlock(),e.createElementBlock("span",d,e.toDisplayString(Q.value),1)):Z.value||e.unref(D).placeholder?(e.openBlock(),e.createElementBlock("span",c,[e.renderSlot(l.$slots,"placeholder",{},()=>[e.createTextVNode(e.toDisplayString(e.unref(D).placeholder),1)])])):e.createCommentVNode("",!0)])])],10,u),e.unref(M)&&!e.unref(D).noDrop?(e.openBlock(),e.createElementBlock("div",f,[e.renderSlot(l.$slots,"drop-placeholder",{},()=>[e.createElementVNode("div",p,e.toDisplayString(ee.value),1)])])):e.createCommentVNode("",!0),e.createElementVNode("input",e.mergeProps({ref_key:"customInputRef",ref:z},V.value.inputAttrs,{type:"file",name:e.unref(D).name,form:e.unref(D).form,multiple:e.unref(D).multiple||e.unref(D).directory,disabled:e.unref(D).disabled,required:e.unref(D).required,accept:_.value||void 0,capture:e.unref(D).capture,directory:e.unref(D).directory,webkitdirectory:e.unref(D).directory,tabindex:"-1","aria-hidden":"true",style:{position:"absolute","z-index":"-5",width:"0",height:"0",opacity:"0",overflow:"hidden","pointer-events":"none"}}),null,16,m)],2)),U.value?(e.openBlock(),e.createElementBlock("div",y,[e.renderSlot(l.$slots,"file-name",{files:H.value,names:K.value},()=>[J.value?(e.openBlock(),e.createElementBlock("div",b,e.toDisplayString(Q.value),1)):Z.value||e.unref(D).placeholder?(e.openBlock(),e.createElementBlock("div",k,[e.renderSlot(l.$slots,"placeholder",{},()=>[e.createTextVNode(e.toDisplayString(e.unref(D).placeholder),1)])])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.unref(D).plain?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",h,e.toDisplayString(X.value),1))],16))}});exports._sfc_main=B;
//# sourceMappingURL=BFormFile.vue_vue_type_script_setup_true_lang-CM0rdpfR.js.map
